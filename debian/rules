#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# Skip tests:
export DEB_BUILD_OPTIONS=nocheck

FLAGS = -DCMAKE_C_COMPILER=gcc \
        -DCMAKE_Fortran_COMPILER=gfortran \
        -DMADX_STATIC=OFF \
        -DMADX_ONLINE=OFF \
        -DBUILD_SHARED_LIBS=ON \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo

%: $(MADX_TARBALL)
	dh $@ --buildsystem=cmake

package=debian/libmadx-dev

override_dh_install:
	dh_install
	mv $(CURDIR)/$(package)/usr/bin/ndiff $(CURDIR)/$(package)/usr/bin/numdiff

override_dh_auto_configure:
	find . -name '._*' -print0 | xargs -0 -r rm
	dh_auto_configure -- $(FLAGS)

#override_dh_auto_test:
#	echo "Skipping tests"
